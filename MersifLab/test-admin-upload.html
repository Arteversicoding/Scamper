<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">Test Admin Upload Functionality</h1>
        
        <div class="space-y-6">
            <!-- Test Service Imports -->
            <div class="border border-gray-200 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üîß Test Service Imports</h3>
                <div id="importStatus" class="text-sm space-y-2"></div>
            </div>
            
            <!-- Test Form Elements -->
            <div class="border border-gray-200 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üìù Test Form Elements</h3>
                <div id="formStatus" class="text-sm space-y-2"></div>
            </div>
            
            <!-- Test Upload -->
            <div class="border border-gray-200 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üöÄ Test Upload</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Judul Materi</label>
                        <input type="text" id="testTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Masukkan judul test">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                        <input type="text" id="testDesc" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Masukkan deskripsi test">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">File Test</label>
                        <input type="file" id="testFile" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                    </div>
                    <button id="testUploadBtn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        Test Upload Lengkap
                    </button>
                </div>
                <div id="uploadResult" class="mt-4 p-3 bg-gray-100 rounded-lg hidden">
                    <h4 class="font-semibold mb-2">Hasil Test:</h4>
                    <pre id="resultText" class="text-sm"></pre>
                </div>
            </div>
            
            <!-- Console Output -->
            <div class="border border-gray-200 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üìã Console Output</h3>
                <div id="consoleOutput" class="text-sm font-mono bg-black text-green-400 p-4 rounded h-48 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Capture console logs
        const consoleOutput = document.getElementById('consoleOutput');
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : 'text-green-400';
            consoleOutput.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        // Test imports
        async function testImports() {
            const importStatus = document.getElementById('importStatus');
            
            try {
                console.log('üîç Testing service imports...');
                
                // Test Supabase
                const { uploadFileToSupabase } = await import('./supabase-service.js');
                console.log('‚úÖ Supabase service imported');
                importStatus.innerHTML += '<div class="text-green-600">‚úÖ Supabase service imported</div>';
                
                // Test Materials
                const { createMaterial } = await import('./materials-service.js');
                console.log('‚úÖ Materials service imported');
                importStatus.innerHTML += '<div class="text-green-600">‚úÖ Materials service imported</div>';
                
                // Test Auth
                const { AuthService } = await import('./auth-service.js');
                console.log('‚úÖ Auth service imported');
                importStatus.innerHTML += '<div class="text-green-600">‚úÖ Auth service imported</div>';
                
                return { uploadFileToSupabase, createMaterial, AuthService };
                
            } catch (error) {
                console.error('‚ùå Import error:', error);
                importStatus.innerHTML += `<div class="text-red-600">‚ùå Import error: ${error.message}</div>`;
                return null;
            }
        }
        
        // Test form elements
        function testFormElements() {
            const formStatus = document.getElementById('formStatus');
            
            const titleInput = document.getElementById('testTitle');
            const descInput = document.getElementById('testDesc');
            const fileInput = document.getElementById('testFile');
            
            if (titleInput) {
                formStatus.innerHTML += '<div class="text-green-600">‚úÖ Title input found</div>';
            } else {
                formStatus.innerHTML += '<div class="text-red-600">‚ùå Title input not found</div>';
            }
            
            if (descInput) {
                formStatus.innerHTML += '<div class="text-green-600">‚úÖ Description input found</div>';
            } else {
                formStatus.innerHTML += '<div class="text-red-600">‚ùå Description input not found</div>';
            }
            
            if (fileInput) {
                formStatus.innerHTML += '<div class="text-green-600">‚úÖ File input found</div>';
            } else {
                formStatus.innerHTML += '<div class="text-red-600">‚ùå File input not found</div>';
            }
        }
        
        // Test upload
        async function testUpload() {
            const title = document.getElementById('testTitle').value.trim();
            const description = document.getElementById('testDesc').value.trim();
            const file = document.getElementById('testFile').files[0];
            
            if (!title || !description || !file) {
                alert('Isi semua field dan pilih file!');
                return;
            }
            
            try {
                console.log('üöÄ Starting upload test...');
                console.log('üìù Data:', { title, description, fileName: file.name, fileSize: file.size });
                
                const services = await testImports();
                if (!services) {
                    throw new Error('Services not available');
                }
                
                const { uploadFileToSupabase, createMaterial } = services;
                
                // Test upload to Supabase
                console.log('üì§ Uploading to Supabase...');
                const uploadResult = await uploadFileToSupabase(file);
                console.log('‚úÖ Upload result:', uploadResult);
                
                // Test save to database
                console.log('üíæ Saving to database...');
                const materialResult = await createMaterial({
                    title,
                    description,
                    file: null,
                    linkUrl: uploadResult.publicUrl
                });
                console.log('‚úÖ Material saved:', materialResult);
                
                // Show result
                const resultDiv = document.getElementById('uploadResult');
                const resultText = document.getElementById('resultText');
                resultText.textContent = JSON.stringify({
                    upload: uploadResult,
                    material: materialResult
                }, null, 2);
                resultDiv.classList.remove('hidden');
                
                console.log('üéâ Upload test completed successfully!');
                
            } catch (error) {
                console.error('‚ùå Upload test failed:', error);
                alert(`Upload test failed: ${error.message}`);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üîß Test page loaded, initializing...');
            
            // Test imports
            await testImports();
            
            // Test form elements
            testFormElements();
            
            // Setup test upload button
            document.getElementById('testUploadBtn').addEventListener('click', testUpload);
            
            console.log('‚úÖ Test page ready');
        });
    </script>
</body>
</html>

